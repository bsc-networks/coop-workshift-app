<!-- app/views/users/preference_access.html.erb -->

<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>

<%= javascript_include_tag "jquery.scrollTableBody-1.0.0.js"  %>
<%=form_tag toggle_preferences_all_path, :id => 'pref_all_form', remote: "true", :authenticity_token => true do %>
  <p> Toggle whether or not the preference form is still editable for all users. </p>
  <div class="col-sm-8 control-label">
    <label for="preference_toggle">Preference Form: </label>
  </div>
  <div class="col-sm-4">
    <div class="input-group">
      <input id="preference_toggle" name="pref_all" type="checkbox" checked data-toggle="toggle" data-on="Open" data-off="Closed" data-onstyle="success" data-offstyle="danger">
    </div>
  </div>
<% end %>

<p>
  Search below to view the 
</p>


<div class="col-md-12" style="margin-top:30px;">
  <table id="Workshifts_uploaded" class="table table-striped table-hover"
                      data-toggle="table" data-search="true">
    <thead>
      <tr>
        <th data-sortable="true">Name</th>
      </tr>
    </thead>
    <tbody>
      <% @users.each do | user | %>
        <tr>
          <td>
            <%= link_to user.full_name, admin_view_user_path(user.id) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>


<script>
$(document).ready(function() {
  $('#pref_all_form').submit(function() {  
      var valuesToSubmit = $(this).serialize();
      $.ajax({
          type: "POST",
          url: $(this).attr('action'), //sumbits it to the given url of the form
          data: valuesToSubmit,
          dataType: "JSON" // you want a difference between normal and ajax-calls, and json is standard
      }).success(function(json){
          console.log("success", json);
      });
      return false; // prevents normal behaviour
  });
  $('#preference_toggle').change(function() {
    $( "#pref_all_form" ).submit();
  });
  
  $('table').scrollTableBody();
});
</script>